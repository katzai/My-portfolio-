<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Portfolio Manager</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #FFFFFF;
            --bg-secondary: #F8F9FA;
            --text-primary: #1A1A1A;
            --text-secondary: #6B6B6B;
            --accent: #6366F1;
            --danger: #EF4444;
            --success: #10B981;
            --warning: #F59E0B;
            --border: #E5E7EB;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
        }

        /* Login Screen */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .login-box {
            background: white;
            border-radius: 16px;
            padding: 60px;
            max-width: 450px;
            width: 100%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
        }

        .login-title {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 12px;
            text-align: center;
            color: var(--accent);
        }

        .login-subtitle {
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: 40px;
            font-size: 15px;
        }

        .keypad-display {
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            font-family: 'Courier New', monospace;
            font-size: 32px;
            letter-spacing: 12px;
            margin-bottom: 30px;
            min-height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent);
        }

        .keypad-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .keypad-btn {
            background: white;
            border: 2px solid var(--border);
            border-radius: 10px;
            padding: 20px;
            font-size: 24px;
            font-weight: 600;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s;
        }

        .keypad-btn:hover {
            background: var(--bg-secondary);
            border-color: var(--accent);
        }

        .keypad-btn:active {
            transform: scale(0.95);
        }

        .clear-btn {
            background: var(--danger);
            color: white;
            border: none;
        }

        .clear-btn:hover {
            background: #DC2626;
        }

        /* GitHub Setup Banner */
        .github-setup-banner {
            background: linear-gradient(135deg, var(--warning) 0%, #F97316 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            display: none;
        }

        .github-setup-banner.show {
            display: block;
        }

        .github-setup-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .github-setup-text {
            font-size: 14px;
            margin-bottom: 16px;
            opacity: 0.95;
        }

        .github-setup-btn {
            background: white;
            color: var(--warning);
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .github-setup-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        /* Admin Panel */
        .admin-panel {
            display: none;
            min-height: 100vh;
            padding: 20px;
        }

        .admin-header {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            flex-wrap: wrap;
            gap: 20px;
        }

        .admin-title {
            font-size: 28px;
            font-weight: 800;
            color: var(--accent);
        }

        .admin-actions {
            display: flex;
            gap: 10px;
        }

        .logout-btn, .sync-btn {
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }

        .logout-btn {
            background: var(--danger);
            color: white;
        }

        .sync-btn {
            background: var(--success);
            color: white;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sync-btn:hover, .logout-btn:hover {
            transform: translateY(-2px);
        }

        .sync-btn.syncing {
            opacity: 0.7;
            pointer-events: none;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .sync-icon {
            display: inline-block;
            animation: rotate 1s linear infinite;
        }

        /* Stats Dashboard */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--accent);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .stat-label {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-badge {
            background: var(--success);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .stat-badge.warning {
            background: var(--warning);
        }

        .stat-number {
            font-size: 48px;
            font-weight: 800;
            color: var(--text-primary);
            line-height: 1;
        }

        /* Content Sections */
        .content-section {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--bg-secondary);
        }

        .section-title {
            font-size: 22px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .add-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }

        .add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        /* Item Cards */
        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .item-card {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .item-card:hover {
            border-color: var(--accent);
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .item-header {
            margin-bottom: 12px;
        }

        .item-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .item-subtitle {
            font-size: 13px;
            color: var(--accent);
            font-weight: 600;
        }

        .item-description {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 16px;
        }

        .item-images {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 8px;
            margin-bottom: 16px;
        }

        .item-image {
            aspect-ratio: 1;
            border-radius: 8px;
            overflow: hidden;
            background: white;
        }

        .item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .item-actions {
            display: flex;
            gap: 8px;
        }

        .item-btn {
            flex: 1;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
        }

        .item-btn-edit {
            background: var(--accent);
            color: white;
        }

        .item-btn-delete {
            background: var(--danger);
            color: white;
        }

        .item-btn:hover {
            transform: translateY(-2px);
        }

        /* Image Gallery */
        .images-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
        }

        .image-card {
            position: relative;
            aspect-ratio: 3/4;
            border-radius: 12px;
            overflow: hidden;
            background: var(--bg-secondary);
            cursor: pointer;
            transition: all 0.3s;
        }

        .image-card:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .image-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            padding: 16px;
            transform: translateY(100%);
            transition: transform 0.3s;
        }

        .image-card:hover .image-overlay {
            transform: translateY(0);
        }

        .image-name {
            color: white;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            word-break: break-word;
        }

        .image-delete {
            background: var(--danger);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-title {
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 24px;
            color: var(--text-primary);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
            font-size: 14px;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 15px;
            font-family: inherit;
            transition: all 0.2s;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-actions {
            display: flex;
            gap: 12px;
            margin-top: 32px;
        }

        .form-btn {
            flex: 1;
            padding: 14px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 15px;
        }

        .form-btn-primary {
            background: var(--accent);
            color: white;
        }

        .form-btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .form-btn:hover {
            transform: translateY(-2px);
        }

        /* Image Selection Grid */
        .image-selection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
            max-height: 300px;
            overflow-y: auto;
            padding: 12px;
            background: var(--bg-secondary);
            border-radius: 8px;
        }

        .selectable-image {
            position: relative;
            aspect-ratio: 1;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.2s;
        }

        .selectable-image:hover {
            transform: scale(1.05);
        }

        .selectable-image.selected {
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
        }

        .selectable-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-check {
            position: absolute;
            top: 6px;
            right: 6px;
            width: 24px;
            height: 24px;
            background: var(--accent);
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 14px;
        }

        .selectable-image.selected .image-check {
            display: flex;
        }

        /* Bulk Crop Modal Styles */
        .bulk-crop-modal .modal-content {
            max-width: 900px;
        }

        .crop-layout {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        #currentCropContainer {
            background: var(--bg-secondary);
            border-radius: 12px;
            overflow: hidden;
            min-height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #currentCropImage {
            max-width: 100%;
            max-height: 500px;
            display: block;
        }

        #pendingCropsList {
            max-height: 500px;
            overflow-y: auto;
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 16px;
        }

        .pending-crop-item {
            display: flex;
            gap: 12px;
            padding: 12px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .pending-crop-thumb {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 6px;
            flex-shrink: 0;
        }

        .pending-crop-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-width: 0;
        }

        .pending-crop-name {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .pending-crop-status {
            font-size: 12px;
            color: var(--text-secondary);
        }

        #cropProgress {
            background: var(--accent);
            color: white;
            padding: 16px;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .crop-controls {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .crop-btn {
            padding: 14px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 15px;
        }

        .crop-btn-primary {
            background: var(--success);
            color: white;
        }

        .crop-btn-secondary {
            background: var(--warning);
            color: white;
        }

        .crop-btn-finish {
            background: var(--accent);
            color: white;
            grid-column: 1 / -1;
        }

        .crop-btn-cancel {
            background: var(--danger);
            color: white;
        }

        .crop-btn:hover {
            transform: translateY(-2px);
        }

        /* Message Notifications */
        .message-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 3000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 400px;
        }

        .message {
            background: white;
            padding: 16px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            font-weight: 600;
            min-width: 300px;
            transform: translateX(500px);
            transition: transform 0.3s ease;
        }

        .message.show {
            transform: translateX(0);
        }

        .message.success {
            border-left: 4px solid var(--success);
        }

        .message.error {
            border-left: 4px solid var(--danger);
        }

        .message.warning {
            border-left: 4px solid var(--warning);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .login-box {
                padding: 40px 30px;
            }

            .admin-header {
                padding: 20px;
            }

            .content-section {
                padding: 20px;
            }

            .modal-content {
                padding: 30px 20px;
            }

            .items-grid {
                grid-template-columns: 1fr;
            }

            .images-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }

            .crop-layout {
                grid-template-columns: 1fr;
            }

            .message-container {
                left: 20px;
                right: 20px;
                max-width: none;
            }

            .message {
                min-width: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Message Container -->
    <div class="message-container" id="messageContainer"></div>

    <!-- Login Screen -->
    <div class="login-container" id="loginScreen">
        <div class="login-box">
            <h1 class="login-title">üîê Admin Access</h1>
            <p class="login-subtitle">Enter your 4-digit PIN to continue</p>
            
            <div class="keypad-display" id="pinDisplay">‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div>
            
            <div class="keypad-grid">
                <button class="keypad-btn" onclick="addPin('1')">1</button>
                <button class="keypad-btn" onclick="addPin('2')">2</button>
                <button class="keypad-btn" onclick="addPin('3')">3</button>
                <button class="keypad-btn" onclick="addPin('4')">4</button>
                <button class="keypad-btn" onclick="addPin('5')">5</button>
                <button class="keypad-btn" onclick="addPin('6')">6</button>
                <button class="keypad-btn" onclick="addPin('7')">7</button>
                <button class="keypad-btn" onclick="addPin('8')">8</button>
                <button class="keypad-btn" onclick="addPin('9')">9</button>
                <button class="keypad-btn clear-btn" onclick="clearPin()">Clear</button>
                <button class="keypad-btn" onclick="addPin('0')">0</button>
                <button class="keypad-btn" onclick="deletePin()">‚å´</button>
            </div>
        </div>
    </div>

    <!-- Admin Panel -->
    <div class="admin-panel" id="adminPanel">
        <!-- GitHub Setup Banner -->
        <div class="github-setup-banner" id="githubSetupBanner">
            <div class="github-setup-title">‚ö†Ô∏è GitHub Not Configured</div>
            <div class="github-setup-text">
                Connect your GitHub repository to enable auto-sync. Your portfolio data will be stored safely in your repo.
            </div>
            <button class="github-setup-btn" onclick="showGitHubSetupModal()">‚öôÔ∏è Configure GitHub</button>
        </div>

        <!-- Header -->
        <div class="admin-header">
            <h1 class="admin-title">üìä Portfolio Admin</h1>
            <div class="admin-actions">
                <button class="sync-btn" id="syncBtn" onclick="syncToGitHub()">
                    <span id="syncIcon">üîÑ</span>
                    <span id="syncText">Sync to GitHub</span>
                </button>
                <button class="logout-btn" onclick="logout()">üö™ Logout</button>
            </div>
        </div>

        <!-- Stats Dashboard -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-label">üìÅ Projects</span>
                    <span class="stat-badge warning" id="projectsSyncStatus">Local</span>
                </div>
                <div class="stat-number" id="projectCount">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-label">üìû Contacts</span>
                    <span class="stat-badge warning" id="contactsSyncStatus">Local</span>
                </div>
                <div class="stat-number" id="contactCount">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-label">üñºÔ∏è Images</span>
                    <span class="stat-badge warning" id="imagesSyncStatus">Local</span>
                </div>
                <div class="stat-number" id="imageCount">0</div>
            </div>
        </div>

        <!-- Projects Section -->
        <div class="content-section">
            <div class="section-header">
                <h2 class="section-title">üìÅ Projects</h2>
                <button class="add-btn" onclick="showAddProjectModal()">‚ûï Add New Project</button>
            </div>
            <div class="items-grid" id="projectsList"></div>
        </div>

        <!-- Contacts Section -->
        <div class="content-section">
            <div class="section-header">
                <h2 class="section-title">üìû Contact Methods</h2>
                <button class="add-btn" onclick="showAddContactModal()">‚ûï Add New Contact</button>
            </div>
            <div class="items-grid" id="contactsList"></div>
        </div>

        <!-- Images Section -->
        <div class="content-section">
            <div class="section-header">
                <h2 class="section-title">üñºÔ∏è Image Library</h2>
                <label class="add-btn" style="cursor: pointer;">
                    ‚ûï Upload Images
                    <input type="file" id="imageUpload" accept="image/*" multiple style="display: none;" onchange="handleImageUpload(event)">
                </label>
            </div>
            <div class="images-grid" id="imagesList"></div>
        </div>
    </div>

    <!-- GitHub Setup Modal -->
    <div class="modal" id="githubSetupModal">
        <div class="modal-content">
            <h2 class="modal-title">‚öôÔ∏è GitHub Configuration</h2>
            
            <div class="form-group">
                <label class="form-label">GitHub Username *</label>
                <input type="text" class="form-input" id="githubUsername" placeholder="your-username">
            </div>
            
            <div class="form-group">
                <label class="form-label">Repository Name *</label>
                <input type="text" class="form-input" id="githubRepo" placeholder="portfolio-repo">
            </div>
            
            <div class="form-group">
                <label class="form-label">Branch (optional)</label>
                <input type="text" class="form-input" id="githubBranch" placeholder="main" value="main">
            </div>
            
            <div class="form-group">
                <label class="form-label">Personal Access Token * <a href="https://github.com/settings/tokens" target="_blank" style="color: var(--accent); font-size: 12px;">(Get Token)</a></label>
                <input type="password" class="form-input" id="githubToken" placeholder="ghp_xxxxxxxxxxxxx">
            </div>
            
            <div class="form-actions">
                <button class="form-btn form-btn-secondary" onclick="testGitHubConnection()">üß™ Test Connection</button>
                <button class="form-btn form-btn-primary" onclick="saveGitHubConfig()">üíæ Save Config</button>
            </div>
        </div>
    </div>

    <!-- Project Modal -->
    <div class="modal" id="projectModal">
        <div class="modal-content">
            <h2 class="modal-title" id="projectModalTitle">Add New Project</h2>
            
            <div class="form-group">
                <label class="form-label">Project Title *</label>
                <input type="text" class="form-input" id="projectTitle" placeholder="My Awesome Project">
            </div>
            
            <div class="form-group">
                <label class="form-label">Project Type *</label>
                <input type="text" class="form-input" id="projectType" placeholder="Web App, Mobile App, etc.">
            </div>
            
            <div class="form-group">
                <label class="form-label">Description *</label>
                <textarea class="form-textarea" id="projectDescription" placeholder="Describe your project..."></textarea>
            </div>
            
            <div class="form-group">
                <label class="form-label">Project Link (optional)</label>
                <input type="url" class="form-input" id="projectLink" placeholder="https://example.com">
            </div>
            
            <div class="form-group">
                <label class="form-label">Select Images (click to select multiple)</label>
                <div class="image-selection-grid" id="projectImageSelection"></div>
            </div>
            
            <div class="form-actions">
                <button class="form-btn form-btn-secondary" onclick="closeModal('projectModal')">Cancel</button>
                <button class="form-btn form-btn-primary" onclick="saveProject()">üíæ Save Project</button>
            </div>
        </div>
    </div>

    <!-- Contact Modal -->
    <div class="modal" id="contactModal">
        <div class="modal-content">
            <h2 class="modal-title" id="contactModalTitle">Add New Contact</h2>
            
            <div class="form-group">
                <label class="form-label">Icon (emoji) *</label>
                <input type="text" class="form-input" id="contactIcon" placeholder="üìß" maxlength="2">
            </div>
            
            <div class="form-group">
                <label class="form-label">Label *</label>
                <input type="text" class="form-input" id="contactLabel" placeholder="Email">
            </div>
            
            <div class="form-group">
                <label class="form-label">Value *</label>
                <input type="text" class="form-input" id="contactValue" placeholder="your.email@example.com">
            </div>
            
            <div class="form-group">
                <label class="form-label">Link *</label>
                <input type="url" class="form-input" id="contactLink" placeholder="mailto:your.email@example.com">
            </div>
            
            <div class="form-actions">
                <button class="form-btn form-btn-secondary" onclick="closeModal('contactModal')">Cancel</button>
                <button class="form-btn form-btn-primary" onclick="saveContact()">üíæ Save Contact</button>
            </div>
        </div>
    </div>

    <!-- Bulk Crop Modal -->
    <div class="modal bulk-crop-modal" id="bulkCropModal">
        <div class="modal-content">
            <h2 class="modal-title">‚úÇÔ∏è Crop Your Images</h2>
            
            <div id="cropProgress">üì∏ Processing images...</div>
            
            <div class="crop-layout">
                <div id="currentCropContainer">
                    <img id="currentCropImage" alt="Image to crop">
                </div>
                <div id="pendingCropsList"></div>
            </div>
            
            <div class="crop-controls">
                <button class="crop-btn crop-btn-secondary" id="skipCropBtn" onclick="skipCurrentCrop()">‚è≠Ô∏è Skip Crop</button>
                <button class="crop-btn crop-btn-primary" id="applyCropBtn" onclick="applyCropAndNext()">‚úÇÔ∏è Crop & Next</button>
                <button class="crop-btn crop-btn-finish" id="finishCropBtn" onclick="finishCropping()" style="display: none;">‚úÖ Finish & Save</button>
                <button class="crop-btn crop-btn-cancel" onclick="closeBulkCropModal()">‚ùå Cancel</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <script>
        // Storage Keys - Match with index.html
        var STORAGE_KEYS = {
            pin: 'admin_pin',
            projects: 'portfolioProjects',  // Changed to match index.html
            contacts: 'portfolioContacts',  // Changed to match index.html
            images: 'portfolioImages',      // Changed to match index.html
            githubConfig: 'github_config'
        };

        // State
        var currentPin = '';
        var editingProjectIndex = -1;
        var editingContactIndex = -1;
        var cropper = null;
        var pendingCrops = [];
        var currentCropIndex = 0;
        var croppedImages = [];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            checkLogin();
            checkGitHubConfig();
            loadProjects();
            loadContacts();
            loadImages();
            updateStats();
        });

        // Login
        function checkLogin() {
            var savedPin = localStorage.getItem(STORAGE_KEYS.pin);
            if (!savedPin) {
                localStorage.setItem(STORAGE_KEYS.pin, '2583'); // Default PIN
            }
        }

        function addPin(digit) {
            if (currentPin.length < 4) {
                currentPin += digit;
                updatePinDisplay();
                
                if (currentPin.length === 4) {
                    checkPin();
                }
            }
        }

        function deletePin() {
            if (currentPin.length > 0) {
                currentPin = currentPin.slice(0, -1);
                updatePinDisplay();
            }
        }

        function clearPin() {
            currentPin = '';
            updatePinDisplay();
        }

        function updatePinDisplay() {
            var display = document.getElementById('pinDisplay');
            var filled = '';
            var empty = '';
            for (var i = 0; i < currentPin.length; i++) {
                filled += '‚Ä¢';
            }
            for (var j = 0; j < 4 - currentPin.length; j++) {
                empty += '‚óã';
            }
            display.textContent = filled + empty;
        }

        function checkPin() {
            var savedPin = localStorage.getItem(STORAGE_KEYS.pin);
            
            if (currentPin === savedPin) {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                clearPin();
            } else {
                showMessage('‚ùå Incorrect PIN', 'error');
                clearPin();
            }
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('adminPanel').style.display = 'none';
                clearPin();
            }
        }

        // GitHub Configuration
        function checkGitHubConfig() {
            var config = getGitHubConfig();
            if (!config.username || !config.repo || !config.token) {
                document.getElementById('githubSetupBanner').classList.add('show');
                updateSyncStatus('warning');
            } else {
                updateSyncStatus('success');
            }
        }

        function getGitHubConfig() {
            try {
                var config = localStorage.getItem(STORAGE_KEYS.githubConfig);
                return config ? JSON.parse(config) : {};
            } catch (e) {
                return {};
            }
        }

        function showGitHubSetupModal() {
            var config = getGitHubConfig();
            document.getElementById('githubUsername').value = config.username || '';
            document.getElementById('githubRepo').value = config.repo || '';
            document.getElementById('githubBranch').value = config.branch || 'main';
            document.getElementById('githubToken').value = config.token || '';
            document.getElementById('githubSetupModal').classList.add('active');
        }

        function saveGitHubConfig() {
            var config = {
                username: document.getElementById('githubUsername').value.trim(),
                repo: document.getElementById('githubRepo').value.trim(),
                branch: document.getElementById('githubBranch').value.trim() || 'main',
                token: document.getElementById('githubToken').value.trim()
            };

            if (!config.username || !config.repo || !config.token) {
                showMessage('Please fill in all required fields', 'error');
                return;
            }

            localStorage.setItem(STORAGE_KEYS.githubConfig, JSON.stringify(config));
            closeModal('githubSetupModal');
            document.getElementById('githubSetupBanner').classList.remove('show');
            showMessage('GitHub configuration saved successfully!', 'success');
            updateSyncStatus('success');
        }

        // Test GitHub connection
        function testGitHubConnection() {
            var username = document.getElementById('githubUsername').value.trim();
            var repo = document.getElementById('githubRepo').value.trim();
            var token = document.getElementById('githubToken').value.trim();
            
            if (!username || !repo || !token) {
                showMessage('Please enter username, repository and token first', 'error');
                return;
            }
            
            showMessage('Testing connection...', 'warning');
            
            fetch('https://api.github.com/repos/' + username + '/' + repo, {
                method: 'GET',
                headers: {
                    'Authorization': 'token ' + token,
                    'Accept': 'application/vnd.github.v3+json'
                }
            })
            .then(function(response) {
                if (!response.ok) {
                    return response.json().then(function(err) {
                        throw new Error(err.message || 'Connection failed');
                    });
                }
                return response.json();
            })
            .then(function(repoData) {
                showMessage('‚úÖ Connected! Repo: ' + repoData.full_name, 'success');
            })
            .catch(function(error) {
                var msg = '‚ùå Failed: ';
                if (error.message.indexOf('404') !== -1) msg += 'Repository not found';
                else if (error.message.indexOf('401') !== -1) msg += 'Invalid token';
                else if (error.message.indexOf('403') !== -1) msg += 'Token needs "repo" permission';
                else msg += error.message;
                showMessage(msg, 'error');
            });
        }

        function updateSyncStatus(status) {
            var badges = ['projectsSyncStatus', 'contactsSyncStatus', 'imagesSyncStatus'];
            for (var i = 0; i < badges.length; i++) {
                var badge = document.getElementById(badges[i]);
                if (status === 'success') {
                    badge.textContent = 'Synced';
                    badge.className = 'stat-badge';
                } else if (status === 'warning') {
                    badge.textContent = 'Local';
                    badge.className = 'stat-badge warning';
                }
            }
        }

        // Sync to GitHub - FIXED VERSION
        function syncToGitHub() {
            var config = getGitHubConfig();
            
            if (!config.username || !config.repo || !config.token) {
                showMessage('Please configure GitHub settings first', 'error');
                showGitHubSetupModal();
                return;
            }

            var syncBtn = document.getElementById('syncBtn');
            var syncIcon = document.getElementById('syncIcon');
            var syncText = document.getElementById('syncText');
            
            syncBtn.classList.add('syncing');
            syncIcon.classList.add('sync-icon');
            syncText.textContent = 'Syncing...';

            // Use setTimeout to avoid stack overflow
            setTimeout(function() {
                performSync(config, syncBtn, syncIcon, syncText);
            }, 100);
        }

        function performSync(config, syncBtn, syncIcon, syncText) {
            try {
                var projects = JSON.parse(localStorage.getItem(STORAGE_KEYS.projects) || '[]');
                var contacts = JSON.parse(localStorage.getItem(STORAGE_KEYS.contacts) || '[]');

                // Create safe project data without circular references
                var safeProjects = [];
                for (var i = 0; i < projects.length; i++) {
                    var project = projects[i];
                    var imageFiles = [];
                    
                    if (project.images && Array.isArray(project.images)) {
                        for (var j = 0; j < project.images.length; j++) {
                            imageFiles.push('projects/' + sanitizeFilename(project.title) + '/image-' + (j + 1) + '.jpg');
                        }
                    }
                    
                    safeProjects.push({
                        title: project.title,
                        type: project.type,
                        description: project.description,
                        link: project.link || '',
                        images: imageFiles
                    });
                }

                // Create data.json content
                var dataJson = {
                    projects: safeProjects,
                    contacts: contacts
                };

                // Upload data.json first
                uploadFileToGitHub(
                    config,
                    'data.json',
                    JSON.stringify(dataJson, null, 2),
                    'Update portfolio data',
                    false
                ).then(function() {
                    // Then upload images one by one
                    return uploadProjectImages(config, projects, 0);
                }).then(function() {
                    showMessage('‚úÖ Successfully synced to GitHub!', 'success');
                    updateSyncStatus('success');
                }).catch(function(error) {
                    console.error('Sync error:', error);
                    showMessage('‚ùå Sync failed: ' + error.message, 'error');
                }).finally(function() {
                    syncBtn.classList.remove('syncing');
                    syncIcon.classList.remove('sync-icon');
                    syncText.textContent = 'Sync to GitHub';
                });
                
            } catch (error) {
                console.error('Sync error:', error);
                showMessage('‚ùå Sync failed: ' + error.message, 'error');
                syncBtn.classList.remove('syncing');
                syncIcon.classList.remove('sync-icon');
                syncText.textContent = 'Sync to GitHub';
            }
        }

        function uploadProjectImages(config, projects, projectIndex) {
            if (projectIndex >= projects.length) {
                return Promise.resolve();
            }

            var project = projects[projectIndex];
            var folderName = sanitizeFilename(project.title);
            
            if (!project.images || !Array.isArray(project.images) || project.images.length === 0) {
                return uploadProjectImages(config, projects, projectIndex + 1);
            }

            return uploadImagesForProject(config, project, folderName, 0)
                .then(function() {
                    return uploadProjectImages(config, projects, projectIndex + 1);
                });
        }

        function uploadImagesForProject(config, project, folderName, imageIndex) {
            if (imageIndex >= project.images.length) {
                return Promise.resolve();
            }

            var imageData = project.images[imageIndex];
            var imagePath = 'projects/' + folderName + '/image-' + (imageIndex + 1) + '.jpg';
            
            // Extract base64 data
            var base64Data = imageData.indexOf(',') !== -1 ? imageData.split(',')[1] : imageData;
            
            return uploadFileToGitHub(
                config,
                imagePath,
                base64Data,
                'Add image ' + (imageIndex + 1) + ' for ' + project.title,
                true
            ).then(function() {
                return uploadImagesForProject(config, project, folderName, imageIndex + 1);
            });
        }

        // Upload file to GitHub via API - FIXED VERSION
        function uploadFileToGitHub(config, path, content, message, isBase64) {
            var url = 'https://api.github.com/repos/' + config.username + '/' + config.repo + '/contents/' + path;
            
            // Check if file exists to get SHA
            return fetch(url, {
                headers: {
                    'Authorization': 'token ' + config.token,
                    'Accept': 'application/vnd.github.v3+json'
                }
            }).then(function(checkResponse) {
                if (checkResponse.ok) {
                    return checkResponse.json();
                }
                return null;
            }).then(function(existingFile) {
                // Prepare body
                var body = {
                    message: message,
                    content: isBase64 ? content : btoa(unescape(encodeURIComponent(content))),
                    branch: config.branch
                };

                if (existingFile && existingFile.sha) {
                    body.sha = existingFile.sha;
                }

                // Upload/Update file
                return fetch(url, {
                    method: 'PUT',
                    headers: {
                        'Authorization': 'token ' + config.token,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(body)
                });
            }).then(function(response) {
                if (!response.ok) {
                    return response.json().then(function(error) {
                        throw new Error(error.message || 'Failed to upload file');
                    });
                }
                return response.json();
            });
        }

        // Utility: Sanitize filename
        function sanitizeFilename(name) {
            return name
                .toLowerCase()
                .replace(/[^a-z0-9]+/g, '-')
                .replace(/^-|-$/g, '');
        }

        // Image Upload and Bulk Cropping - FIXED FOR UNLIMITED IMAGES
        function handleImageUpload(event) {
            var files = event.target.files;
            if (!files || files.length === 0) return;
            
            pendingCrops = [];
            currentCropIndex = 0;
            croppedImages = [];
            
            // Load all files
            var fileArray = Array.from(files);
            var loadedCount = 0;
            var imageFiles = fileArray.filter(function(f) { return f.type.startsWith('image/'); });
            
            if (imageFiles.length === 0) {
                showMessage('No valid image files selected', 'error');
                event.target.value = '';
                return;
            }
            
            for (var i = 0; i < imageFiles.length; i++) {
                (function(file) {
                    var reader = new FileReader();
                    reader.onload = function(e) {
                        pendingCrops.push({
                            name: file.name,
                            data: e.target.result,
                            cropped: false
                        });
                        
                        loadedCount++;
                        if (loadedCount === imageFiles.length) {
                            // All files loaded, show crop modal
                            showBulkCropModal();
                        }
                    };
                    reader.onerror = function() {
                        loadedCount++;
                        if (loadedCount === imageFiles.length) {
                            showBulkCropModal();
                        }
                    };
                    reader.readAsDataURL(file);
                })(imageFiles[i]);
            }
            
            event.target.value = '';
        }

        function showBulkCropModal() {
            if (pendingCrops.length === 0) {
                showMessage('No images to process', 'error');
                return;
            }
            
            // Reset UI state
            document.getElementById('currentCropContainer').style.display = 'block';
            document.getElementById('skipCropBtn').style.display = 'block';
            document.getElementById('applyCropBtn').style.display = 'block';
            document.getElementById('finishCropBtn').style.display = 'none';
            
            document.getElementById('bulkCropModal').classList.add('active');
            loadCurrentCrop();
            updatePendingCropsList();
        }

        function loadCurrentCrop() {
            if (currentCropIndex >= pendingCrops.length) {
                return;
            }
            
            var current = pendingCrops[currentCropIndex];
            var img = document.getElementById('currentCropImage');
            
            // Destroy previous cropper
            if (cropper) {
                cropper.destroy();
                cropper = null;
            }
            
            img.src = current.data;
            
            // Initialize new cropper after image loads
            img.onload = function() {
                cropper = new Cropper(img, {
                    aspectRatio: NaN,
                    viewMode: 1,
                    autoCropArea: 1,
                    responsive: true,
                    background: false,
                    zoomable: true,
                    scalable: true,
                    rotatable: true
                });
            };
            
            updateCropProgress();
        }

        function updateCropProgress() {
            var progress = document.getElementById('cropProgress');
            var total = pendingCrops.length;
            var current = currentCropIndex + 1;
            var cropped = croppedImages.length;
            
            progress.textContent = 'üì∏ Image ' + current + ' of ' + total + ' (' + cropped + ' processed)';
            progress.style.background = 'var(--accent)';
            progress.style.color = 'white';
        }

        function updatePendingCropsList() {
            var list = document.getElementById('pendingCropsList');
            
            if (pendingCrops.length <= 1) {
                list.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 20px;">Only one image - no queue needed!</div>';
                return;
            }
            
            var html = '<div style="font-weight: 600; margin-bottom: 10px; color: var(--text-secondary);">üìã Queue (' + pendingCrops.length + ' total):</div>';
            
            for (var i = 0; i < pendingCrops.length; i++) {
                if (i === currentCropIndex) continue; // Skip current
                
                var item = pendingCrops[i];
                var status = item.cropped ? '‚úÖ Done' : '‚è≥ Waiting';
                html += '<div class="pending-crop-item">' +
                    '<img src="' + item.data + '" class="pending-crop-thumb" alt="' + item.name + '">' +
                    '<div class="pending-crop-info">' +
                        '<div class="pending-crop-name">' + item.name + '</div>' +
                        '<div class="pending-crop-status">' + status + '</div>' +
                    '</div>' +
                '</div>';
            }
            
            list.innerHTML = html;
        }

        function applyCropAndNext() {
            if (!cropper) {
                showMessage('Cropper not initialized', 'error');
                return;
            }
            
            var canvas = cropper.getCroppedCanvas({
                maxWidth: 2000,
                maxHeight: 2000,
                imageSmoothingQuality: 'high'
            });
            
            var croppedData = canvas.toDataURL('image/jpeg', 0.9);
            
            croppedImages.push({
                name: pendingCrops[currentCropIndex].name,
                data: croppedData
            });
            
            pendingCrops[currentCropIndex].cropped = true;
            currentCropIndex++;
            
            if (currentCropIndex < pendingCrops.length) {
                loadCurrentCrop();
                updatePendingCropsList();
            } else {
                showCropCompletionState();
            }
        }

        function skipCurrentCrop() {
            // Add original image without cropping
            croppedImages.push({
                name: pendingCrops[currentCropIndex].name,
                data: pendingCrops[currentCropIndex].data
            });
            
            pendingCrops[currentCropIndex].cropped = true;
            currentCropIndex++;
            
            if (currentCropIndex < pendingCrops.length) {
                loadCurrentCrop();
                updatePendingCropsList();
            } else {
                showCropCompletionState();
            }
        }

        function showCropCompletionState() {
            if (cropper) {
                cropper.destroy();
                cropper = null;
            }
            
            document.getElementById('currentCropContainer').style.display = 'none';
            
            var progress = document.getElementById('cropProgress');
            progress.textContent = '‚úÖ All ' + croppedImages.length + ' images processed! Click Finish to save.';
            progress.style.background = 'var(--success)';
            progress.style.color = 'white';
            
            var html = '<div style="font-weight: 600; margin-bottom: 10px; color: var(--text-primary);">üì∏ Processed Images:</div>';
            for (var i = 0; i < croppedImages.length; i++) {
                var item = croppedImages[i];
                html += '<div class="pending-crop-item">' +
                    '<img src="' + item.data + '" class="pending-crop-thumb" alt="' + item.name + '">' +
                    '<div class="pending-crop-info">' +
                        '<div class="pending-crop-name">' + item.name + '</div>' +
                        '<div class="pending-crop-status" style="color: var(--success);">‚úÖ Ready</div>' +
                    '</div>' +
                '</div>';
            }
            
            document.getElementById('pendingCropsList').innerHTML = html;
            
            // Show finish button, hide others
            document.getElementById('skipCropBtn').style.display = 'none';
            document.getElementById('applyCropBtn').style.display = 'none';
            document.getElementById('finishCropBtn').style.display = 'block';
        }

        function finishCropping() {
            // Save all cropped images
            var images = JSON.parse(localStorage.getItem(STORAGE_KEYS.images) || '[]');
            for (var i = 0; i < croppedImages.length; i++) {
                images.push({
                    name: croppedImages[i].name,
                    data: croppedImages[i].data,
                    timestamp: Date.now()
                });
            }
            localStorage.setItem(STORAGE_KEYS.images, JSON.stringify(images));
            
            closeBulkCropModal();
            loadImages();
            updateStats();
            showMessage(croppedImages.length + ' image(s) uploaded successfully!', 'success');
            updateSyncStatus('warning');
            
            // Reset
            pendingCrops = [];
            currentCropIndex = 0;
            croppedImages = [];
        }

        function closeBulkCropModal() {
            if (cropper) {
                cropper.destroy();
                cropper = null;
            }
            
            document.getElementById('currentCropContainer').style.display = 'block';
            document.getElementById('cropProgress').style.background = '';
            document.getElementById('cropProgress').style.color = '';
            document.getElementById('skipCropBtn').style.display = 'block';
            document.getElementById('applyCropBtn').style.display = 'block';
            document.getElementById('finishCropBtn').style.display = 'none';
            
            document.getElementById('bulkCropModal').classList.remove('active');
            
            // Reset state
            pendingCrops = [];
            currentCropIndex = 0;
            croppedImages = [];
        }

        // Image Management
        function loadImages() {
            var images = JSON.parse(localStorage.getItem(STORAGE_KEYS.images) || '[]');
            var imagesList = document.getElementById('imagesList');
            
            if (images.length === 0) {
                imagesList.innerHTML = '<p style="text-align: center; color: var(--text-secondary); grid-column: 1/-1;">No images yet. Click "Upload Images" to get started!</p>';
                return;
            }
            
            var html = '';
            for (var i = 0; i < images.length; i++) {
                var img = images[i];
                html += '<div class="image-card">' +
                    '<img src="' + img.data + '" alt="' + img.name + '">' +
                    '<div class="image-overlay">' +
                        '<div class="image-name">' + img.name + '</div>' +
                        '<button class="image-delete" onclick="deleteImage(' + i + ')">üóëÔ∏è Delete</button>' +
                    '</div>' +
                '</div>';
            }
            imagesList.innerHTML = html;
        }

        function deleteImage(index) {
            if (confirm('Delete this image? This cannot be undone.')) {
                var images = JSON.parse(localStorage.getItem(STORAGE_KEYS.images) || '[]');
                images.splice(index, 1);
                localStorage.setItem(STORAGE_KEYS.images, JSON.stringify(images));
                loadImages();
                updateStats();
                showMessage('Image deleted', 'success');
                updateSyncStatus('warning');
            }
        }

        // Project Management
        function loadProjects() {
            var projects = JSON.parse(localStorage.getItem(STORAGE_KEYS.projects) || '[]');
            var projectsList = document.getElementById('projectsList');
            
            if (projects.length === 0) {
                projectsList.innerHTML = '<p style="text-align: center; color: var(--text-secondary); grid-column: 1/-1;">No projects yet. Click "Add New Project" to get started!</p>';
                return;
            }
            
            var html = '';
            for (var i = 0; i < projects.length; i++) {
                var project = projects[i];
                var imagesHtml = '';
                
                if (project.images && project.images.length > 0) {
                    imagesHtml = '<div class="item-images">';
                    for (var j = 0; j < project.images.length; j++) {
                        imagesHtml += '<div class="item-image"><img src="' + project.images[j] + '" alt="Project image"></div>';
                    }
                    imagesHtml += '</div>';
                }
                
                html += '<div class="item-card">' +
                    '<div class="item-header">' +
                        '<h3 class="item-title">' + project.title + '</h3>' +
                        '<p class="item-subtitle">' + project.type + '</p>' +
                    '</div>' +
                    '<p class="item-description">' + project.description + '</p>' +
                    imagesHtml +
                    '<div class="item-actions">' +
                        '<button class="item-btn item-btn-edit" onclick="editProject(' + i + ')">‚úèÔ∏è Edit</button>' +
                        '<button class="item-btn item-btn-delete" onclick="deleteProject(' + i + ')">üóëÔ∏è Delete</button>' +
                    '</div>' +
                '</div>';
            }
            projectsList.innerHTML = html;
        }

        function showAddProjectModal() {
            editingProjectIndex = -1;
            document.getElementById('projectModalTitle').textContent = 'Add New Project';
            document.getElementById('projectTitle').value = '';
            document.getElementById('projectType').value = '';
            document.getElementById('projectDescription').value = '';
            document.getElementById('projectLink').value = '';
            
            renderImageSelection('projectImageSelection', []);
            document.getElementById('projectModal').classList.add('active');
        }

        function editProject(index) {
            editingProjectIndex = index;
            var projects = JSON.parse(localStorage.getItem(STORAGE_KEYS.projects) || '[]');
            var project = projects[index];
            
            document.getElementById('projectModalTitle').textContent = 'Edit Project';
            document.getElementById('projectTitle').value = project.title;
            document.getElementById('projectType').value = project.type;
            document.getElementById('projectDescription').value = project.description;
            document.getElementById('projectLink').value = project.link || '';
            
            renderImageSelection('projectImageSelection', project.images || []);
            document.getElementById('projectModal').classList.add('active');
        }

        function saveProject() {
            var title = document.getElementById('projectTitle').value.trim();
            var type = document.getElementById('projectType').value.trim();
            var description = document.getElementById('projectDescription').value.trim();
            var link = document.getElementById('projectLink').value.trim();
            
            if (!title || !type || !description) {
                showMessage('Please fill in all required fields', 'error');
                return;
            }
            
            var selectedImages = getSelectedImages('projectImageSelection');
            
            var projectData = {
                title: title,
                type: type,
                description: description,
                link: link,
                images: selectedImages
            };
            
            var projects = JSON.parse(localStorage.getItem(STORAGE_KEYS.projects) || '[]');
            
            if (editingProjectIndex >= 0) {
                projects[editingProjectIndex] = projectData;
            } else {
                projects.push(projectData);
            }
            
            localStorage.setItem(STORAGE_KEYS.projects, JSON.stringify(projects));
            
            closeModal('projectModal');
            loadProjects();
            updateStats();
            showMessage('Project saved! Click "Sync to GitHub" to publish.', 'success');
            updateSyncStatus('warning');
        }

        function deleteProject(index) {
            if (confirm('Delete this project?')) {
                var projects = JSON.parse(localStorage.getItem(STORAGE_KEYS.projects) || '[]');
                projects.splice(index, 1);
                localStorage.setItem(STORAGE_KEYS.projects, JSON.stringify(projects));
                loadProjects();
                updateStats();
                showMessage('Project deleted', 'success');
                updateSyncStatus('warning');
            }
        }

        // Contact Management
        function loadContacts() {
            var contacts = JSON.parse(localStorage.getItem(STORAGE_KEYS.contacts) || '[]');
            var contactsList = document.getElementById('contactsList');
            
            if (contacts.length === 0) {
                contactsList.innerHTML = '<p style="text-align: center; color: var(--text-secondary); grid-column: 1/-1;">No contacts yet. Click "Add New Contact" to get started!</p>';
                return;
            }
            
            var html = '';
            for (var i = 0; i < contacts.length; i++) {
                var contact = contacts[i];
                html += '<div class="item-card">' +
                    '<div class="item-header">' +
                        '<h3 class="item-title">' + contact.icon + ' ' + contact.label + '</h3>' +
                    '</div>' +
                    '<p class="item-description">' + contact.value + '</p>' +
                    '<p style="font-size: 13px; color: var(--accent); margin-bottom: 12px;">üîó ' + contact.link + '</p>' +
                    '<div class="item-actions">' +
                        '<button class="item-btn item-btn-edit" onclick="editContact(' + i + ')">‚úèÔ∏è Edit</button>' +
                        '<button class="item-btn item-btn-delete" onclick="deleteContact(' + i + ')">üóëÔ∏è Delete</button>' +
                    '</div>' +
                '</div>';
            }
            contactsList.innerHTML = html;
        }

        function showAddContactModal() {
            editingContactIndex = -1;
            document.getElementById('contactModalTitle').textContent = 'Add New Contact';
            document.getElementById('contactIcon').value = '';
            document.getElementById('contactLabel').value = '';
            document.getElementById('contactValue').value = '';
            document.getElementById('contactLink').value = '';
            
            document.getElementById('contactModal').classList.add('active');
        }

        function editContact(index) {
            editingContactIndex = index;
            var contacts = JSON.parse(localStorage.getItem(STORAGE_KEYS.contacts) || '[]');
            var contact = contacts[index];
            
            document.getElementById('contactModalTitle').textContent = 'Edit Contact';
            document.getElementById('contactIcon').value = contact.icon;
            document.getElementById('contactLabel').value = contact.label;
            document.getElementById('contactValue').value = contact.value;
            document.getElementById('contactLink').value = contact.link;
            
            document.getElementById('contactModal').classList.add('active');
        }

        function saveContact() {
            var icon = document.getElementById('contactIcon').value.trim();
            var label = document.getElementById('contactLabel').value.trim();
            var value = document.getElementById('contactValue').value.trim();
            var link = document.getElementById('contactLink').value.trim();
            
            if (!icon || !label || !value || !link) {
                showMessage('Please fill in all fields', 'error');
                return;
            }
            
            var contactData = { 
                icon: icon, 
                label: label, 
                value: value, 
                link: link 
            };
            var contacts = JSON.parse(localStorage.getItem(STORAGE_KEYS.contacts) || '[]');
            
            if (editingContactIndex >= 0) {
                contacts[editingContactIndex] = contactData;
            } else {
                contacts.push(contactData);
            }
            
            localStorage.setItem(STORAGE_KEYS.contacts, JSON.stringify(contacts));
            
            closeModal('contactModal');
            loadContacts();
            updateStats();
            showMessage('Contact saved! Click "Sync to GitHub" to publish.', 'success');
            updateSyncStatus('warning');
        }

        function deleteContact(index) {
            if (confirm('Delete this contact?')) {
                var contacts = JSON.parse(localStorage.getItem(STORAGE_KEYS.contacts) || '[]');
                contacts.splice(index, 1);
                localStorage.setItem(STORAGE_KEYS.contacts, JSON.stringify(contacts));
                loadContacts();
                updateStats();
                showMessage('Contact deleted', 'success');
                updateSyncStatus('warning');
            }
        }

        // Image Selection - FIXED FOR MULTIPLE SELECTION
        function renderImageSelection(containerId, selectedImages) {
            selectedImages = selectedImages || [];
            var images = JSON.parse(localStorage.getItem(STORAGE_KEYS.images) || '[]');
            var container = document.getElementById(containerId);
            
            if (images.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); grid-column: 1/-1;">No images available. Upload images first!</p>';
                return;
            }
            
            var html = '';
            for (var i = 0; i < images.length; i++) {
                var img = images[i];
                var isSelected = false;
                
                // Check if this image is selected
                for (var j = 0; j < selectedImages.length; j++) {
                    if (selectedImages[j] === img.data) {
                        isSelected = true;
                        break;
                    }
                }
                
                html += '<div class="selectable-image' + (isSelected ? ' selected' : '') + '" ' +
                    'onclick="toggleImageSelection(this, \'' + img.data.replace(/'/g, "\\'") + '\', \'' + containerId + '\')">' +
                    '<img src="' + img.data + '" alt="' + img.name + '">' +
                    '<div class="image-check">‚úì</div>' +
                '</div>';
            }
            container.innerHTML = html;
        }

        function toggleImageSelection(element, imageData, containerId) {
            element.classList.toggle('selected');
        }

        function getSelectedImages(containerId) {
            var container = document.getElementById(containerId);
            var selectedElements = container.querySelectorAll('.selectable-image.selected img');
            var selectedImages = [];
            for (var i = 0; i < selectedElements.length; i++) {
                selectedImages.push(selectedElements[i].src);
            }
            return selectedImages;
        }

        // Modal Functions
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            
            if (cropper) {
                cropper.destroy();
                cropper = null;
            }
        }

        // Stats
        function updateStats() {
            var projects = JSON.parse(localStorage.getItem(STORAGE_KEYS.projects) || '[]');
            var contacts = JSON.parse(localStorage.getItem(STORAGE_KEYS.contacts) || '[]');
            var images = JSON.parse(localStorage.getItem(STORAGE_KEYS.images) || '[]');
            
            document.getElementById('projectCount').textContent = projects.length;
            document.getElementById('contactCount').textContent = contacts.length;
            document.getElementById('imageCount').textContent = images.length;
        }

        // Messages
        function showMessage(message, type) {
            type = type || 'success';
            var container = document.getElementById('messageContainer');
            var messageEl = document.createElement('div');
            messageEl.className = 'message ' + type + ' show';
            messageEl.textContent = message;
            
            container.appendChild(messageEl);
            
            setTimeout(function() {
                messageEl.classList.remove('show');
                setTimeout(function() { 
                    if (messageEl.parentNode) {
                        messageEl.parentNode.removeChild(messageEl);
                    }
                }, 300);
            }, 3000);
        }

        // Close modals on background click
        var modals = document.querySelectorAll('.modal');
        for (var i = 0; i < modals.length; i++) {
            (function(modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        closeModal(modal.id);
                    }
                });
            })(modals[i]);
        }
    </script>
</body>
  </html>
